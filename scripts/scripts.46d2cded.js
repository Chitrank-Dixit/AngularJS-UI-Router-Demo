"use strict";angular.module("myApp",["ui.router","ngAnimate","config","angular-loading-bar","LocalStorageModule"]).config(["$stateProvider","$urlRouterProvider","localStorageServiceProvider",function(a,b,c){c.setPrefix("myApp");var d=["$state","selectedMovie",function(a,b){angular.isDefined(b)||a.go("main.movies")}],e=["movies","$stateParams","$filter",function(a,b,c){var d=c("filter")(a,{urlAlias:b.name});return d[0]}];b.otherwise("/movies"),a.state("main",{url:"/","abstract":!0,views:{header:{templateUrl:"views/main/header.html"},footer:{templateUrl:"views/main/footer.html"}}}).state("main.movies",{url:"movies",views:{"content@":{templateUrl:"views/pages/movies/movies.html",controller:"moviesController",controllerAs:"movies"},"preview@main.movies":{templateUrl:"views/pages/movies/movie.preview.html"},"summary@main.movies":{templateUrl:"views/pages/movies/movie.summary.html"}},resolve:{movies:["Movies",function(a){return a.gettingMovies(30)}]}}).state("main.bookmarks",{url:"bookmarks",views:{"content@":{templateUrl:"views/pages/movies/movies.html",controller:"moviesController",controllerAs:"movies"},"preview@main.bookmarks":{templateUrl:"views/pages/movies/movie.preview.html"},"summary@main.bookmarks":{templateUrl:"views/pages/movies/movie.summary.html"}},resolve:{movies:["Bookmarks",function(a){return a.getMovies()}]}}).state("main.movieInfo",{url:"movie-info/{name}",views:{"content@":{templateUrl:"views/pages/movieInfo.html",controller:"movieController",controllerAs:"movie"}},resolve:{selectedMovie:e,movies:["Movies",function(a){return a.gettingMovies(30)}]},onEnter:d}).state("main.trailer",{url:"trailer/{name}",views:{"content@":{templateUrl:"views/pages/trailer.html",controller:"movieController",controllerAs:"movie"}},resolve:{selectedMovie:e,movies:["Movies",function(a){return a.gettingMovies(30)}]},onEnter:d,data:{movie:{basePath:"http://www.youtube.com/embed/?listType=search&list=",params:{controls:2,modestbranding:1,rel:0,showinfo:0,autoplay:1,hd:1}}}})}]).run(["$rootScope","$state","$stateParams","localStorageService","$log",function(a,b,c,d){a.$state=b,a.$stateParams=c,a.localStorageService=d,d.isSupported?console.log("Support ",d.getStorageType()):console.log("No support!",d.getStorageType())}]),angular.module("config",[]).constant("Config",{debugUiRouter:!0}).value("debug",!0),angular.module("myApp").controller("moviesController",["$scope","$stateParams","$state","movies","Bookmarks",function(a,b,c,d,e){var f=this;f.data=d,f.addToBookmarks=function(a){e.addToBookmarks(a).then(function(b){b.saved&&(a.isBookmarked=!0)})},f.removeFromBookmarks=function(a){e.removeFromBookmarks(a).then(function(b){b.deleted&&(a.isBookmarked=!1)})}}]),angular.module("myApp").controller("movieController",["$scope","$stateParams","$state","Movies","selectedMovie","movies",function(a,b,c,d,e,f){var g=this;g.selectedMovie=e,g.movies=f,angular.isDefined(c.current.data)&&(g.movieTrailerUrl=d.gettingMovieTrailerUrl(g.selectedMovie.trackName,c.current.data.movie))}]),angular.module("myApp").factory("Movies",["$http","$q","$sce",function(a,b,c){function d(c){var d=b.defer();return a({method:"GET",url:"https://itunes.apple.com/us/rss/topmovies/limit="+c+"/json"}).success(function(a){var b=[];angular.forEach(a.feed.entry,function(a){b.push(a.id.attributes["im:id"])}),d.resolve(b)}),d.promise}function e(c){if(angular.isArray(c)){var d=b.defer();return a.jsonp("https://itunes.apple.com/lookup",{params:{id:c.join(),callback:"JSON_CALLBACK"}}).success(function(a){angular.forEach(a.results,function(a,b){a.id=c[b],a.originBookmark=!1,a.index=b+1,a.artworkUrl600=a.artworkUrl100.replace("100x100","600x600"),a.urlAlias=a.trackName.replace(/ /g,"-").toLowerCase()}),d.resolve(a.results)}),d.promise}}return{gettingMovies:function(a){var c=b.defer();return d(a).then(function(a){e(a).then(function(a){c.resolve(a)})}),c.promise},gettingMovieTrailerUrl:function(a,b){var d=[];return angular.forEach(b.params,function(a,b){this.push(b+"="+a)},d),d="&"+d.join("&"),c.trustAsResourceUrl(encodeURI(b.basePath+a+" trailer"+d))}}}]),angular.module("myApp").factory("Bookmarks",["localStorageService","$filter","$q",function(a,b,c){return{addToBookmarks:function(b){var d=c.defer(),e={};angular.copy(b,e);var f=null!=a.get("bookmarks")?a.get("bookmarks"):new Array;e.originBookmark=!0,e.index=f.length?f.length+1:1,f.push(e);var g=a.set("bookmarks",f);return g?d.resolve({saved:g,error:!1}):d.reject({saved:g,error:!0}),d.promise},removeFromBookmarks:function(d){var e=c.defer(),f=a.get("bookmarks"),g=b("filter")(f,{id:d.id});f.splice(g[0].index-1,1),angular.forEach(f,function(a,b){a.index=b+1});var h=a.set("bookmarks",f);return h?e.resolve({deleted:h,error:!1}):e.reject({deleted:h,error:!0}),e.promise},getMovies:function(){var b=c.defer();return b.resolve(a.get("bookmarks")),b.promise},isMovieBookmarked:function(){return!0}}}]),angular.module("myApp").directive("scrollbar",function(){return{restrict:"EA",link:function(a,b){b.mCustomScrollbar({setHeight:75,theme:"light-thick"})}}}),angular.module("myApp").directive("movieLink",["$state","$filter",function(a,b){return{restrict:"A",scope:{movieLink:"@",selectedMovieIndex:"=",movies:"="},link:function(c,d){var e=c.selectedMovieIndex,f=a.current.name,g=function(){e!=c.movies.length&&"next"==c.movieLink?e+=1:e>1&&"previous"==c.movieLink&&(e-=1);var d=b("filter")(c.movies,{index:e}),d=d[0];a.go(f,{name:d.urlAlias})};d.bind("click",g),d.text(c.movieLink),d.addClass(c.movieLink)}}}]);