"use strict";angular.module("myApp",["ui.router","ngAnimate","config","angular-loading-bar","LocalStorageModule"]).config(["$stateProvider","$urlRouterProvider","localStorageServiceProvider",function(a,b,c){c.setPrefix("myApp");var d=["$state","selectedMovie",function(a,b){angular.isDefined(b)||a.go("main.movies")}],e=["movies","$stateParams","$filter",function(a,b,c){var d=c("filter")(a,{urlAlias:b.name});return d[0]}];b.otherwise("/movies"),a.state("main",{url:"/","abstract":!0,views:{header:{templateUrl:"views/main/header.html"},footer:{templateUrl:"views/main/footer.html"}}}).state("main.movies",{url:"movies",views:{"content@":{templateUrl:"views/pages/movies/movies.html",controller:"moviesController",controllerAs:"movies"},"preview@main.movies":{templateUrl:"views/pages/movies/movie.preview.html"},"summary@main.movies":{templateUrl:"views/pages/movies/movie.summary.html"}},resolve:{movies:["Movies",function(a){return a.gettingMovies(30)}]}}).state("main.bookmarks",{url:"bookmarks",views:{"content@":{templateUrl:"views/pages/movies/movies.html",controller:"moviesController",controllerAs:"movies"},"preview@main.bookmarks":{templateUrl:"views/pages/movies/movie.preview.html"},"summary@main.bookmarks":{templateUrl:"views/pages/movies/movie.summary.html"}},resolve:{movies:["Bookmarks",function(a){return a.getMovies()}]}}).state("main.movieInfo",{url:"movie-info/{name}",views:{"content@":{templateUrl:"views/pages/movieInfo.html",controller:"movieController",controllerAs:"movie"}},resolve:{selectedMovie:e,movies:["Movies",function(a){return a.gettingMovies(30)}]},onEnter:d}).state("main.trailer",{url:"trailer/{name}",views:{"content@":{templateUrl:"views/pages/trailer.html",controller:"movieController",controllerAs:"movie"}},resolve:{selectedMovie:e,movies:["Movies",function(a){return a.gettingMovies(30)}]},onEnter:d,data:{movie:{basePath:"http://www.youtube.com/embed/?listType=search&list=",params:{controls:2,modestbranding:1,rel:0,showinfo:0,autoplay:1,hd:1}}}})}]).run(["$rootScope","$state","$stateParams","localStorageService","$log",function(a,b,c,d){a.$state=b,a.$stateParams=c,a.localStorageService=d,d.isSupported?console.log("Support ",d.getStorageType()):console.log("No support!",d.getStorageType())}]),angular.module("config",[]).constant("Config",{debugUiRouter:!0}).value("debug",!0),angular.module("myApp").controller("moviesController",["$scope","$stateParams","$state","movies","Bookmarks",function(a,b,c,d,e){var f=this;f.data=d,f.addToBookmarks=function(a){e.addToBookmarks(a).then(function(b){b.saved&&(a.isBookmarked=!0)})},f.removeFromBookmarks=function(a){e.removeFromBookmarks(a).then(function(b){b.deleted&&(a.isBookmarked=!1,a.originBookmark&&e.getMovies().then(function(a){f.data=a}))})}}]),angular.module("myApp").controller("movieController",["$scope","$stateParams","$state","Movies","selectedMovie","movies",function(a,b,c,d,e,f){var g=this;g.selectedMovie=e,g.movies=f,angular.isDefined(c.current.data)&&(g.movieTrailerUrl=d.gettingMovieTrailerUrl(g.selectedMovie.trackName,c.current.data.movie))}]),angular.module("myApp").factory("Movies",["$http","$q","$sce","Bookmarks",function(a,b,c,d){function e(c){var d=b.defer();return a({method:"GET",url:"https://itunes.apple.com/us/rss/topmovies/limit="+c+"/json"}).success(function(a){var b=[];angular.forEach(a.feed.entry,function(a){b.push(a.id.attributes["im:id"])}),d.resolve(b)}),d.promise}function f(c){if(angular.isArray(c)){var e=b.defer();return a.jsonp("https://itunes.apple.com/lookup",{params:{id:c.join(),callback:"JSON_CALLBACK"}}).success(function(a){angular.forEach(a.results,function(a,b){a.id=c[b],a.isBookmarked=d.isMovieBookmarked(a.id),a.originBookmark=!1,a.index=b+1,a.artworkUrl600=a.artworkUrl100.replace("100x100","600x600"),a.urlAlias=a.trackName.replace(/ /g,"-").toLowerCase()}),e.resolve(a.results)}),e.promise}}return{gettingMovies:function(a){var c=b.defer();return e(a).then(function(a){f(a).then(function(a){c.resolve(a)})}),c.promise},gettingMovieTrailerUrl:function(a,b){var d=[];return angular.forEach(b.params,function(a,b){this.push(b+"="+a)},d),d="&"+d.join("&"),c.trustAsResourceUrl(encodeURI(b.basePath+a+" trailer"+d))}}}]),angular.module("myApp").factory("Bookmarks",["localStorageService","$filter","$q",function(a,b,c){var d=[];return d=a.get("bookmarks"),{addToBookmarks:function(b){var e=c.defer(),f={};angular.copy(b,f);var g=null!=d?d:new Array;f.originBookmark=!0,f.isBookmarked=!0,f.index=g.length?g.length+1:1,g.push(f);var h=a.set("bookmarks",g);return h?e.resolve({saved:h,error:!1}):e.reject({saved:h,error:!0}),e.promise},removeFromBookmarks:function(e){var f=c.defer(),g=d,h=b("filter")(g,{id:e.id});g.splice(h[0].index-1,1),angular.forEach(g,function(a,b){a.index=b+1});var i=a.set("bookmarks",g);return i?f.resolve({deleted:i,error:!1}):f.reject({deleted:i,error:!0}),f.promise},getMovies:function(){var a=c.defer();return a.resolve(d),a.promise},isMovieBookmarked:function(a){var c=d,e=b("filter")(c,{id:a});return e.length?!0:!1}}}]),angular.module("myApp").directive("scrollbar",function(){return{restrict:"EA",link:function(a,b){b.mCustomScrollbar({setHeight:75,theme:"light-thick"})}}}),angular.module("myApp").directive("movieLink",["$state","$filter",function(a,b){return{restrict:"A",scope:{movieLink:"@",selectedMovieIndex:"=",movies:"="},link:function(c,d){var e=c.selectedMovieIndex,f=a.current.name,g=function(){e!=c.movies.length&&"next"==c.movieLink?e+=1:e>1&&"previous"==c.movieLink&&(e-=1);var d=b("filter")(c.movies,{index:e}),d=d[0];a.go(f,{name:d.urlAlias})};d.bind("click",g),d.text(c.movieLink),d.addClass(c.movieLink)}}}]);